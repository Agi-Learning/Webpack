# Single Spa + Federated Modules = Wow

* So last week we looked at Federated modules in Web Ack 5. And I got a great question from Alexander in the comments about whether this enabled the kind of cross platform technology requirement of microfront end frameworks, right? The ability to use react on the same page as view, for example. And the short answer is, no, it doesn't. But then I got to think about it, and I was like, you know, maybe I could use single spa for this on top of Federated modules. And so I dusted off some old code And today we're gonna redo this application. And it's an E commerce app. It's got a header and a footer and They're both implemented in react. It has a fruit selector that's kind of new. It used to be dogs without fruit. And that's implemented in vanilla js. And over on the side is a buy tools that's implemented in spelt. And they all talk together through a shared store. So that's really pretty cool. Now before we get into the code, I want to take a quick step back and talk about the architecture of this and kind of contextualize it a little bit.
* So let's talk about a web map Standard web app I'm just gonna have a bunch of libraries react Done whatever On top of that, you're gonna have a store. And then maybe on top of that, some react components. And in this case, you're gonna have single spot. And one single sot is going to allow you to do is bring in code from other platforms in a micro Fe approach. And let's just say that those are hosted on S3 as individual parcels. That's what they're called in single spa world. So let's dig into single spa little bit. Now, single spa has 2 primary concerns. The first is, you gotta get the javascript onto the page, right? And so what we. use generally there by convention, is system JS to do that loading. And then once it's on the page, that's when the single spot really takes over. And does the orchestration. So now those react and view and sell components are all talking the same lifecycle methods. And so single spa is doing all that management of getting those onto the page and getting them to work correctly. So what if we take that system js and replace it with Federated modules? Now we can move the code for those parcels back into the application itself, where it's a lot easier to maintain, but still share it between applications, which is really. cool. So what we're gonna do now is take a tour of the code and just get right into it. So this is the.

## Code

* The code for that ecommerce page. It's a yarn workspace based system that has five different applications in it. And those are located in packages from the top. You've got buy tools, and that's a spell that home is in where everything ends up kind of landing at the end. Nav is the react based header and footer. Product images is where the vanilla js based fruit grid is, and the store is that shared store. Over in home, we see it bringing in all the remotes for the other applications. This is how you set up federated modules on the client side. Then we bring in material ui css And down in the body, we have the tags where single spawn is going to mount all of our apps. So how do we set that up? And I'm glad you asked. So we're here over an index where we bring in the register application and start from single spa, and then set them up using imports. Okay. Now this is where the difference is not. Normally we would just use system js and system dot import, but because we have federated modules, we can just use regular imports here. And then webpack does all the work of getting that code into the app. Now, over the webpack config we can see the Federated module setup. I can call out for the different remote. So we'll be consuming now for the header footer. Product image for the fruit grid and buy tools for the selt by tools. So let's take an example component I don't see the footer and see how that's set up. We have a normal react component right here at the top. But you can also see us bring in single spa react. And we'll use that to wrap this component as a single spa parcel. It takes react react Dom and the component and it gives us back a bunch of life cycle methods that we can then export Same kind of thing over here in Speltland. We bring in the single spa selt and our component. And then we wrap it and export those lifecycle methods and that's all there is to it. We have apps that wrap components as parcels. And then we have Federated modules to share them with the home page. And they can be reused with any app that uses webpack Federated modules and single spot. All right, so now we get the lay of the land in this pretty complex project So let's go and do a little bit of implementation so.
* Watch the project back in time and we don't have that free grid yet, so let's go build that. Here is Javascript parcel so far. It just usually single spot html library to create a new parcel with the template at this point. Here is the javascript parcel so far It just uses the single spa html library to create a new parcel with the template at this point. But we do have access to home for the list of the fruit and store for the store. So you can see these connections which you need after actually bidirectional. Is it really cool? So let's bring in fruit from home And then remove that hello and checking that out. That looks good. Ok, so we could just add fruit in the template, but I need to know when the component is loaded on the page so that I can set U the event handlers. To do that, I'm gonna Hook the mount method and then call the original And create the html at this point. I'm putting the index in there because we'll need to use that with the event listener that we'll add later. And then I'll set the inner html to all that html. All right, that looks good, but it's kind of big. So let's go and create a grid to constrain that down a little bit. Alright, looking sweet. Literally, we can want some fruit. All right. Now we got our freak selector going. The next thing we want to do is get everybody talking to the store. So picking up where we left off, let's bring in the store and then create an event handler for the click on the images Then we will set the image index in the store to the number that we get back on the attribute. So there's our little store. It's got a card count and an image index, plus a list of subscribers that will get notified when things change. You could use whatever you want for this Rita small bags, what have you. I'm just trying to keep it simple here. So I add some console code to make sure that we're getting called Let's try this out a little. And it looks good. Time to go and update our buy tools, spelled code, look for that image in the store. First thing to do is bring in that store and then set our local image index initially to the store image index, and then subscribe to the store so that we get notifications when that image changes Cool. Looking pretty good. Lovely add to cart button doesn't work, so it should be changing the header. Let's go. Let's go implement that button. Still doesn't work, but that's because the header isn't listening yet. They jump on the way to the header code. And we'll bring in the store and the state and effect hooks. So then we'll set that up so we get the initial cart count, but also subscribe just like you hopefully will do to this channel and. finally, I'll drop the card count value into the HTML Let's take a look. Alright, it looks like they added card is working. As is everything else. And we are good to go. Of course, this is a pretty complex system, so be sure to download the code and try it for yourself. Just experiment a little on it and see how it works for you days. Alright, well, I hope you enjoyed that project. It was a lot of fun and I love the fact that it all stemmed from a question of his place in the comments and I think. you should be inspired to ask questions in the comments and maybe we'll do a video on your question. So. I'm going to take a quick personal beat and talk about why I'm wearing this purple shirt. So I am a proud mentor and parent on pygmy's team. 2733 representing Cleveland High School in Portland, OR. And. I am super inspired by what they've done. They built an amazing bot this year, spending three months of dedicated time to build this pot and unfortunately just three days ahead of their first competition. It was canceled and because of coronavirus. And while I understand the human tragedy that coronavirus is and that this pales in comparison to that for these students and mentors and parents, this is also very devastating to see the work that they put into it and not be able to get to the competition. And I'm no they would have kicked **** in that competition. I am. inspired and humbled to be part of that team. So I just want to put that out there and encourage you guys to involve yourselves in STEM. What you get back, what you put in, you will get back tenfold. III truly believe that and I I've experienced that myself. So I heartily encourage you to engage with stem and in particular women in stem All right. Anyway, I'll get off my soapbox and just say that if you like this video, please like it. If you are interested in these topics, you know this channel, you can just subscribe and of course hit that bell button and then you'll get notifications about when new videos are up. And of course now More than ever, just be good to each other
